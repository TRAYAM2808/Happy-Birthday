<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Birthday Letter</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
    <style>
        /* All your original styles remain exactly the same */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0a0a0a, #1a0a14, #0d0a14);
            color: #e8d5d5;
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            scroll-behavior: smooth;
            /* CHANGE 2: Improved touch handling for mobile */
            touch-action: manipulation;
        }

        /* Particles Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8), transparent);
            border-radius: 50%;
            animation: float linear infinite;
            opacity: 0;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 2;
            padding: 2rem;
        }

        .hero h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(3rem, 10vw, 7rem);
            font-weight: 300;
            text-align: center;
            color: #d4a574;
            text-shadow: 0 0 30px rgba(212, 165, 116, 0.5);
            opacity: 0;
            animation: fadeInGlow 3s ease-in forwards;
            letter-spacing: 0.1em;
        }

        .hero-message {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            max-width: 700px;
            text-align: center;
            margin-top: 2rem;
            line-height: 1.8;
            color: #c9a6a6;
            opacity: 0;
            animation: fadeIn 2s ease-in 1.5s forwards;
        }

        @keyframes fadeInGlow { to { opacity: 1; } }
        @keyframes fadeIn { to { opacity: 1; } }

        /* Scroll Indicator */
        .scroll {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #d4a574;
            font-size: 0.9rem;
            opacity: 0.7;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .book-section { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2rem 1rem; position: relative; z-index: 2; }
        
        /* CHANGE 3: Responsive book sizing for mobile height */
        .book { 
            max-width: 900px; 
            width: 100%; 
            height: clamp(400px, 70vh, 600px); 
            position: relative; 
            perspective: 2000px; 
        }

        .page { position: absolute; width: 50%; height: 100%; right: 0; transform-origin: left; transform-style: preserve-3d; transition: transform 1.2s cubic-bezier(.6,.1,.25,1); box-shadow: 0 20px 60px rgba(0,0,0,.7); cursor: default; }
        
        /* CHANGE 4: Added padding adjustments for smaller mobile screens */
        .page-front, .page-back { 
            position: absolute; 
            inset: 0; 
            padding: clamp(1.5rem, 5vw, 3rem); 
            background: linear-gradient(135deg, #1a0f14, #2a1820); 
            border: 1px solid rgba(212,165,116,.4); 
            backface-visibility: hidden; 
            font-family: 'Cormorant Garamond', serif; 
            color: #c9a6a6; 
            overflow-y: auto; 
        }
        .page-back { transform: rotateY(180deg); background: linear-gradient(135deg, #140a10, #1f0f17); }
        .page.flipped { transform: rotateY(-180deg); }

        .page-front h3 { color: #d4a574; font-size: clamp(1.5rem, 4vw, 2rem); margin-bottom: 1.5rem; text-align: center; font-weight: 400; }
        .page-front p, .page-back p { font-size: clamp(1rem, 3vw, 1.2rem); line-height: 1.8; margin-bottom: 1rem; text-align: justify; }

        .cover .page-front { display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: 0.3s; }
        .cover .page-front:hover { background: linear-gradient(135deg, #22141a, #2a1820); }
        .cover h2 { font-size: clamp(1.8rem, 5vw, 2.8rem); color: #d4a574; font-weight: 300; text-align: center; }

        .nav-controls { margin-top: 2rem; display: flex; gap: 0.5rem; align-items: center; min-height: 50px; flex-wrap: wrap; justify-content: center; }
        .nav-btn { padding: 10px 20px; background: rgba(139,44,61,.3); border: 1px solid rgba(212,165,116,.5); color: #d4a574; cursor: pointer; border-radius: 5px; transition: all 0.3s ease; font-family: 'Montserrat', sans-serif; font-size: 0.8rem; }
        .nav-btn:disabled { opacity: 0.1; cursor: not-allowed; }
        .page-indicator { color: #d4a574; font-family: 'Cormorant Garamond', serif; min-width: 80px; text-align: center; font-size: 0.9rem; }

        .music-player { position: fixed; bottom: 20px; right: 20px; z-index: 100; background: rgba(20,10,15,.95); border: 1px solid rgba(212,165,116,.4); padding: 10px 15px; border-radius: 50px; display: flex; gap: 10px; align-items: center; }
        .play { width: 32px; height: 32px; border-radius: 50%; background: #8b2c3d; border: none; cursor: pointer; position: relative; }
        .play::before { content:''; position: absolute; left: 12px; top: 9px; border-style: solid; border-width: 7px 0 7px 12px; border-color: transparent transparent transparent #d4a574; }
        .play.playing::before { border: none; width: 10px; height: 12px; left: 11px; top: 10px; border-left: 3px solid #d4a574; border-right: 3px solid #d4a574; }
        .music-info { font-size: 0.7rem; white-space: nowrap; }

        /* CHANGE 5: Added specific Media Query to fix the book layout on phones */
        @media(max-width: 900px) { 
            .book { height: 500px; width: 85vw; } 
            .page { width: 100%; left: 0; } 
            .page-back { left: 0; }
            .music-player { bottom: 15px; right: 15px; padding: 8px 12px; }
        }
    </style>
</head>
<body>

<div class="particles" id="particles"></div>
<div class="glow one"></div>
<div class="glow two"></div>

<section class="hero">
    <h1>Happy Birthday</h1>
    <p class="hero-message">In the quiet moments between heartbeats, where light meets shadow,
        today exists only for you. May this year unfold like a story worth telling,
        filled with magic, mystery, and moments that take your breath away.</p>
    <div class="scroll">↓ Scroll to open your letter ↓</div>
</section>

<section class="book-section">
    <div class="book" id="book">
        <div class="page cover" id="cover">
            <div class="page-front">
                <h2>A Letter For You</h2>
                <p>Click to open</p>
            </div>
            <div class="page-back"></div>
        </div>
    </div>
    
    <div class="nav-controls">
        <button class="nav-btn" id="prevBtn">← Previous</button>
        <span class="page-indicator" id="pageIndicator">Cover</span>
        <button class="nav-btn" id="nextBtn">Next →</button>
        <button class="nav-btn" id="closeBtn" style="display:none;">Close & Replay ↺</button>
    </div>
</section>

<div class="music-player">
    <button class="play" id="playBtn"></button>
    <div class="music-info">Background Music</div>
    <audio id="mainAudio" loop>
         <source src="https://www.orangefreesounds.com/wp-content/uploads/2021/09/Emotional-background-piano-solo.mp3" type="audio/mpeg">
    </audio>
</div>

<audio id="pageFlipSound">
    <source src="https://assets.mixkit.co/active_storage/sfx/1101/1101-preview.mp3" type="audio/mpeg">
</audio>

<script>
const pagesData = [
    {
        front: `<h3>Chapter One</h3><p>Your existence is poetry written in flesh and time, a story the universe conspired to tell.</p><p>You are a light that refuses to fade.</p>`,
        back: `<p>Every year you grow more into yourself, like a vintage wine deepening in complexity.</p>`
    },
    {
        front: `<h3>Chapter Two</h3><p>Another year, another chapter—still unfinished, still beautifully imperfect.</p><p>You are becoming more authentically yourself.</p>`,
        back: `<p>And I would read you endlessly, through every plot twist and character development.</p>
               <p>Because the best stories are the ones that keep surprising us, page after page.</p>`
    },
    {
        front: `<h3>Chapter Three</h3><p>May this year bring you closer to your dreams, and may you find beauty in every turn.</p><p>Like a book that gets better with each reading, may you discover new depths within yourself.</p>`,
        back: `<p>Happy Birthday. May your story continue to be extraordinary.</p>`
    }
];

const book = document.getElementById("book");
const cover = document.getElementById("cover");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const closeBtn = document.getElementById("closeBtn");
const pageIndicator = document.getElementById("pageIndicator");
const flipSound = document.getElementById("pageFlipSound");
const audio = document.getElementById("mainAudio");
const playBtn = document.getElementById("playBtn");

let currentState = 0; 
const pageElements = [cover];

pagesData.forEach((data, index) => {
    const page = document.createElement("div");
    page.className = "page";
    page.style.zIndex = pagesData.length - index; 
    page.innerHTML = `<div class="page-front">${data.front}</div><div class="page-back">${data.back}</div>`;
    book.appendChild(page);
    pageElements.push(page);
});

function updateUI() {
    prevBtn.disabled = (currentState === 0);
    if (currentState === pageElements.length - 1) {
        nextBtn.style.display = "none";
        closeBtn.style.display = "block";
    } else {
        nextBtn.style.display = "block";
        closeBtn.style.display = "none";
    }
    pageIndicator.textContent = currentState === 0 ? "Cover" : `Page ${currentState} of ${pagesData.length}`;
}

// CHANGE 6: Added music trigger to the flip function because 
// mobile browsers only allow audio to start after a user tap.
function flipNext() {
    if (currentState < pageElements.length - 1) {
        if (currentState === 0 && audio.paused) {
            audio.play();
            playBtn.classList.add("playing");
        }
        pageElements[currentState].classList.add("flipped");
        pageElements[currentState].style.zIndex = 100 + currentState;
        currentState++;
        playFlip();
        updateUI();
    }
}

function flipPrev() {
    if (currentState > 0) {
        currentState--;
        pageElements[currentState].classList.remove("flipped");
        pageElements[currentState].style.zIndex = pageElements.length - currentState;
        playFlip();
        updateUI();
    }
}

function closeBook() {
    let delay = 0;
    for (let i = currentState - 1; i >= 0; i--) {
        setTimeout(() => {
            pageElements[i].classList.remove("flipped");
            pageElements[i].style.zIndex = pageElements.length - i;
            playFlip();
            if (i === 0) { currentState = 0; updateUI(); }
        }, delay);
        delay += 250; 
    }
}

function playFlip() {
    flipSound.currentTime = 0;
    flipSound.volume = 0.3;
    flipSound.play().catch(() => {});
}

cover.onclick = flipNext;
nextBtn.onclick = flipNext;
prevBtn.onclick = flipPrev;
closeBtn.onclick = closeBook;

playBtn.onclick = () => {
    if (audio.paused) { audio.play(); playBtn.classList.add("playing"); } 
    else { audio.pause(); playBtn.classList.remove("playing"); }
};

const pContainer = document.getElementById("particles");
for(let i = 0; i < 50; i++) {
    let d = document.createElement("div");
    d.className = "particle";
    d.style.left = Math.random() * 100 + "%";
    d.style.animationDuration = (10 + Math.random() * 10) + "s";
    pContainer.appendChild(d);
}

updateUI();
</script>
</body>
</html>